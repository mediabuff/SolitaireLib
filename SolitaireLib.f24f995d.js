parcelRequire=function(e){var r="function"==typeof parcelRequire&&parcelRequire,n="function"==typeof require&&require,i={};function u(e,u){if(e in i)return i[e];var t="function"==typeof parcelRequire&&parcelRequire;if(!u&&t)return t(e,!0);if(r)return r(e,!0);if(n&&"string"==typeof e)return n(e);var o=new Error("Cannot find module '"+e+"'");throw o.code="MODULE_NOT_FOUND",o}return u.register=function(e,r){i[e]=r},i=e(u),u.modules=i,u}(function (require) {function Ja(o){return(Ja="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(o){return typeof o}:function(o){return o&&"function"==typeof Symbol&&o.constructor===Symbol&&o!==Symbol.prototype?"symbol":typeof o})(o)}var q=function(){function o(){}return o.assert=function(r,t){r||o.error(t)},o.error=function(o){if(o=o||"Assert failed","undefined"==typeof Error||Ja(Error))throw new Error(o);throw o},o}();var la={};var X=la&&la.__values||function(e){var o="function"==typeof Symbol&&Symbol.iterator,t=o&&e[o],r=0;if(t)return t.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(o?"Object is not iterable.":"Symbol.iterator is not defined.")},M=function(){function e(e){var o=this;this.touchResponders_=[],this.pxPerRem_=0,this.onResize_=function(){o.refreshUnits_()},this.onWindowMouseMove_=function(e){var t,r,n,i;if(1!==e.buttons)try{for(var a=X(o.touchResponders_),s=a.next();!s.done;s=a.next()){s.value.onTouchUp(-1,!0,e.timeStamp)}}catch(c){t={error:c}}finally{try{s&&!s.done&&(r=a.return)&&r.call(a)}finally{if(t)throw t.error}}else try{for(var u=X(o.touchResponders_),h=u.next();!h.done;h=u.next()){h.value.onTouchMoved(-1,e.pageX,e.pageY,e.timeStamp)}}catch(d){n={error:d}}finally{try{h&&!h.done&&(i=u.return)&&i.call(u)}finally{if(n)throw n.error}}},this.onWindowMouseUp_=function(e){var t,r;if(0===e.button)try{for(var n=X(o.touchResponders_),i=n.next();!i.done;i=n.next()){i.value.onTouchUp(-1,!1,e.timeStamp)}}catch(a){t={error:a}}finally{try{i&&!i.done&&(r=n.return)&&r.call(n)}finally{if(t)throw t.error}}},this.onWindowTouchMove_=function(e){for(var t,r,n=0;n<e.changedTouches.length;++n){var i=e.changedTouches.item(n);if(i)try{for(var a=(t=void 0,X(o.touchResponders_)),s=a.next();!s.done;s=a.next()){s.value.onTouchMoved(i.identifier,i.pageX,i.pageY,e.timeStamp)}}catch(u){t={error:u}}finally{try{s&&!s.done&&(r=a.return)&&r.call(a)}finally{if(t)throw t.error}}}},this.onWindowTouchEnd_=function(e){for(var t,r,n=0;n<e.changedTouches.length;++n){var i=e.changedTouches.item(n);if(i)try{for(var a=(t=void 0,X(o.touchResponders_)),s=a.next();!s.done;s=a.next()){s.value.onTouchUp(i.identifier,!1,e.timeStamp)}}catch(u){t={error:u}}finally{try{s&&!s.done&&(r=a.return)&&r.call(a)}finally{if(t)throw t.error}}}},this.onWindowTouchCancel_=function(e){for(var t,r,n=0;n<e.changedTouches.length;++n){var i=e.changedTouches.item(n);if(i)try{for(var a=(t=void 0,X(o.touchResponders_)),s=a.next();!s.done;s=a.next()){s.value.onTouchUp(i.identifier,!0,e.timeStamp)}}catch(u){t={error:u}}finally{try{s&&!s.done&&(r=a.return)&&r.call(a)}finally{if(t)throw t.error}}}},this.element_=e,window.addEventListener("resize",this.onResize_),window.addEventListener("mousemove",this.onWindowMouseMove_),window.addEventListener("mouseup",this.onWindowMouseUp_),window.addEventListener("touchmove",this.onWindowTouchMove_),window.addEventListener("touchend",this.onWindowTouchEnd_),window.addEventListener("touchcancel",this.onWindowTouchCancel_),this.refreshUnits_()}return Object.defineProperty(e.prototype,"pxPerRem",{get:function(){return this.pxPerRem_},enumerable:!0,configurable:!0}),e.prototype.refreshUnits_=function(){var e=getComputedStyle(this.element_);this.pxPerRem_=1/parseFloat(e.fontSize)},e.prototype.addTouchResponder=function(e){var o=this.touchResponders_.indexOf(e);q.assert(o<0),this.touchResponders_.push(e)},e.prototype.removeTouchResponder=function(e){var o=this.touchResponders_.indexOf(e);q.assert(o>=0),this.touchResponders_.splice(o,1)},e.TOUCH_DEADZONE=5,e.TOUCH_DEADZONE_SQ=25,e}();la.ViewContext=M;var ma=function(){function e(){}return e.instantiateTemplate=function(e,t){var r=document.getElementById(t);r instanceof HTMLTemplateElement||q.error();var n=r.content.firstElementChild;n instanceof HTMLElement||q.error();var i=document.importNode(n,!0);return i instanceof HTMLElement||q.error(),e.appendChild(i)},e}();var wa=function(){function t(t){this.context=new M(t),this.element=ma.instantiateTemplate(t,"rootViewTemplate")}return t.prototype.dispose=function(){this.element.remove()},t}();var Q={};var ca={};var Ka,da;(function($){$[$.None=0]="None",$[$.Black=1]="Black",$[$.Red=2]="Red"})(da||(Ka=da={},Ka));var La,j;(function(e){e[e.None=0]="None",e[e.Ace=1]="Ace",e[e.Two=2]="Two",e[e.Three=3]="Three",e[e.Four=4]="Four",e[e.Five=5]="Five",e[e.Six=6]="Six",e[e.Seven=7]="Seven",e[e.Eight=8]="Eight",e[e.Nine=9]="Nine",e[e.Ten=10]="Ten",e[e.Eleven=11]="Eleven",e[e.Twelve=12]="Twelve",e[e.Thirteen=13]="Thirteen",e[e.Jack=100]="Jack",e[e.Queen=101]="Queen",e[e.King=102]="King"})(j||(La=j={},La));var Ma,H;(function($){$[$.None=0]="None",$[$.Spades=1]="Spades",$[$.Hearts=2]="Hearts",$[$.Diamonds=3]="Diamonds",$[$.Clubs=4]="Clubs"})(H||(Ma=H={},Ma));var xa=ca&&ca.__values||function(t){var r="function"==typeof Symbol&&Symbol.iterator,$=r&&t[r],e=0;if($)return $.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&e>=t.length&&(t=void 0),{value:t&&t[e++],done:!t}}};throw new TypeError(r?"Object is not iterable.":"Symbol.iterator is not defined.")},Na=ca&&ca.__read||function(t,r){var $="function"==typeof Symbol&&t[Symbol.iterator];if(!$)return t;var e,o,a=$.call(t),n=[];try{for(;(void 0===r||r-->0)&&!(e=a.next()).done;)n.push(e.value)}catch(i){o={error:i}}finally{try{e&&!e.done&&($=a.return)&&$.call(a)}finally{if(o)throw o.error}}return n},Oa=[[H.Spades,da.Black],[H.Hearts,da.Red],[H.Diamonds,da.Red],[H.Clubs,da.Black]],Pa=[j.Ace,j.Two,j.Three,j.Four,j.Five,j.Six,j.Seven,j.Eight,j.Nine,j.Ten,j.Jack,j.Queen,j.King],na=function(){function t(){}return t.createStandard52Deck=function(t){var r,$,e,o,a=[];try{for(var n=xa(Oa),i=n.next();!i.done;i=n.next()){var l=Na(i.value,2),C=l[0],u=l[1];try{for(var T=(e=void 0,xa(Pa)),I=T.next();!I.done;I=T.next()){var p=I.value,c=t.createCard(C,u,p);a.push(c)}}catch(v){e={error:v}}finally{try{I&&!I.done&&(o=T.return)&&o.call(T)}finally{if(e)throw e.error}}}}catch(s){r={error:s}}finally{try{i&&!i.done&&($=n.return)&&$.call(n)}finally{if(r)throw r.error}}return a},t}();ca.DeckUtils=na;var Qa,z;(function(e){e[e.None=0]="None",e[e.Quick=1]="Quick",e[e.OneByOne=2]="OneByOne",e[e.Settle=3]="Settle"})(z||(Qa=z={},Qa));var ea={};var Ra=214013,Sa=2531011,Ta=4294967295,Ua=(1<<31)-1,ia=function(e){return e*Ra+Sa&Ta},ja=function(e){return(e&Ua)>>16},a=function(){function e(e){this.seed=e}return e.prototype.min=function(){return e.min},e.prototype.max=function(){return e.max},e.prototype.next=function(){var $=ia(this.seed);return[ja($),new e($)]},e.min=0,e.max=Math.pow(2,15)-1,e}(),b=function(){function e(e){this.seed=e}return e.prototype.min=function(){return e.min},e.prototype.max=function(){return e.max},e.prototype.next=function(){var $=ia(this.seed),r=ja($),t=ia($),n=ja(t),o=ia(t);return[2147483648+(ja(o)+(n+(r<<15)<<15)+2147483648|0),new e(o)]},e.min=0,e.max=4294967295,e}();function Va(t){return(0|t)>=0?0|t:4294967296+(0|t)}function Wa(t,r){var n=65535&t,e=65535&r;return n*e+(n*(r>>>16&65535)+(t>>>16&65535)*e<<16)}var Xa=function(){function t(r,n){n>=t.N?(this.states=t.twist(r),this.index=0):(this.states=r,this.index=n)}return t.twist=function(r){for(var n=r.slice(),e=0;e!==t.N-t.M;++e){var i=(n[e]&t.MASK_UPPER)+(n[e+1]&t.MASK_LOWER);n[e]=n[e+t.M]^i>>>1^-(1&i)&t.A}for(e=t.N-t.M;e!==t.N-1;++e){var s=(n[e]&t.MASK_UPPER)+(n[e+1]&t.MASK_LOWER);n[e]=n[e+t.M-t.N]^s>>>1^-(1&s)&t.A}var o=(n[t.N-1]&t.MASK_UPPER)+(n[0]&t.MASK_LOWER);return n[t.N-1]=n[t.M-1]^o>>>1^-(1&o)&t.A,n},t.seeded=function(r){var n=Array(t.N);n[0]=r;for(var e=1;e!==t.N;++e){var i=n[e-1]^n[e-1]>>>30;n[e]=Wa(t.F,i)+e|0}return n},t.from=function(r){return new t(t.seeded(r),t.N)},t.prototype.min=function(){return t.min},t.prototype.max=function(){return t.max},t.prototype.next=function(){var r=this.states[this.index];return r^=this.states[this.index]>>>t.U,r^=r<<t.S&t.B,r^=r<<t.T&t.C,[Va(r^=r>>>t.L),new t(this.states,this.index+1)]},t.min=0,t.max=4294967295,t.N=624,t.M=397,t.R=31,t.A=2567483615,t.F=1812433253,t.U=11,t.S=7,t.B=2636928640,t.T=15,t.C=4022730752,t.L=18,t.MASK_LOWER=Math.pow(2,t.R)-1,t.MASK_UPPER=Math.pow(2,t.R),t}(),Ya=function(t){return Xa.from(t)};var c=function(){function s(s,t,r,i){this.s01=s,this.s00=t,this.s11=r,this.s10=i}return s.prototype.min=function(){return-2147483648},s.prototype.max=function(){return 2147483647},s.prototype.next=function(){var t=this.s00^this.s00<<23,r=this.s01^(this.s01<<23|this.s00>>>9),i=t^this.s10^(t>>>18|r<<14)^(this.s10>>>5|this.s11<<27),n=r^this.s11^r>>>18^this.s11>>>5;return[this.s00+this.s10|0,new s(this.s11,this.s10,n,i)]},s.prototype.jump=function(){for(var t=this,r=0,i=0,n=0,o=0,h=[1667051007,2321340297,1548169110,304075285],e=0;4!==e;++e)for(var u=1;u;u<<=1)h[e]&u&&(r^=t.s01,i^=t.s00,n^=t.s11,o^=t.s10),t=t.next()[1];return new s(r,i,n,o)},s}();var d=function(){function s(s,t,r,o){this.s01=s,this.s00=t,this.s11=r,this.s10=o}return s.prototype.min=function(){return-2147483648},s.prototype.max=function(){return 2147483647},s.prototype.next=function(){var t=this.s10^this.s00,r=this.s11^this.s01,o=this.s00<<24^this.s01>>>8^t^t<<16,i=this.s01<<24^this.s00>>>8^r^(r<<16|t>>>16),n=r<<5^t>>>27,h=t<<5^r>>>27;return[this.s00+this.s10|0,new s(i,o,h,n)]},s.prototype.jump=function(){for(var t=this,r=0,o=0,i=0,n=0,h=[3639956645,3750757012,1261568508,386426335],e=0;4!==e;++e)for(var u=1;u;u<<=1)h[e]&u&&(r^=t.s01,o^=t.s00,i^=t.s11,n^=t.s10),t=t.next()[1];return new s(r,o,i,n)},s}();function ya(r,n,t){var a=t.min(),o=t.max()-t.min()+1;if(n<=o)for(var i=t,$=o-o%n;;){var f=(l=i.next())[0]-a;if(i=l[1],f<$)return[f%n+r,i]}for(var u=1,e=0;u<n;)u*=o,++e;for(var v=n*Math.floor(1*u/n),m=t;;){for(var I=0,g=0;g!==e;++g){var l;I=o*I+((l=m.next())[0]-a),m=l[1]}if(I<v)return[I-n*Math.floor(1*I/n)+r,m]}}function Za(r,n,t){var a=n-r+1;return null!=t?ya(r,a,t):function(n){return ya(r,a,n)}}var Y=function(){function e(e,r,t,$,n,i){this.pileIndex=0,this.faceUp=!1,this.pileChanged=function(){},this.pileIndexChanged=function(){},this.faceUpChanged=function(){},this.game=e,this.suit=r,this.colour=t,this.rank=$,this.pile=n,this.pileIndex=i}return e.prototype.onPileChanged=function(e,r){this.pile===e?this.onPileIndexChanged(r):(this.pile=e,this.pileIndex=r,this.pile?q.assert(this.pileIndex===this.pile.indexOf(this)):q.assert(0===this.pileIndex),this.pileChanged())},e.prototype.onPileIndexChanged=function(e){this.pileIndex!==e&&(this.pileIndex=e,this.pile?q.assert(this.pileIndex===this.pile.indexOf(this)):q.assert(0===this.pileIndex),this.pileIndexChanged())},e.prototype.flip=function(e){var r=this;if(this.faceUp!==e){var t=this.faceUp,$=function(){return r.flip_(e)};return this.game.addUndoableOperation($,function(){return r.flip_(t)}),$()}},e.prototype.flip_=function(e){this.faceUp=e,this.faceUpChanged()},e.prototype.getEmoji=function(){if(!this.faceUp)return"\uD83C\uDCA0";switch(this.suit){case H.Spades:switch(this.rank){case j.Ace:return"\uD83C\uDCA1";case j.Two:return"\uD83C\uDCA2";case j.Three:return"\uD83C\uDCA3";case j.Four:return"\uD83C\uDCA4";case j.Five:return"\uD83C\uDCA5";case j.Six:return"\uD83C\uDCA6";case j.Seven:return"\uD83C\uDCA7";case j.Eight:return"\uD83C\uDCA8";case j.Nine:return"\uD83C\uDCA9";case j.Ten:return"\uD83C\uDCAA";case j.Jack:return"\uD83C\uDCAB";case j.Queen:return"\uD83C\uDCAD";case j.King:return"\uD83C\uDCAE";}break;case H.Hearts:switch(this.rank){case j.Ace:return"\uD83C\uDCB1";case j.Two:return"\uD83C\uDCB2";case j.Three:return"\uD83C\uDCB3";case j.Four:return"\uD83C\uDCB4";case j.Five:return"\uD83C\uDCB5";case j.Six:return"\uD83C\uDCB6";case j.Seven:return"\uD83C\uDCB7";case j.Eight:return"\uD83C\uDCB8";case j.Nine:return"\uD83C\uDCB9";case j.Ten:return"\uD83C\uDCBA";case j.Jack:return"\uD83C\uDCBB";case j.Queen:return"\uD83C\uDCBD";case j.King:return"\uD83C\uDCBE";}break;case H.Diamonds:switch(this.rank){case j.Ace:return"\uD83C\uDCC1";case j.Two:return"\uD83C\uDCC2";case j.Three:return"\uD83C\uDCC3";case j.Four:return"\uD83C\uDCC4";case j.Five:return"\uD83C\uDCC5";case j.Six:return"\uD83C\uDCC6";case j.Seven:return"\uD83C\uDCC7";case j.Eight:return"\uD83C\uDCC8";case j.Nine:return"\uD83C\uDCC9";case j.Ten:return"\uD83C\uDCCA";case j.Jack:return"\uD83C\uDCCB";case j.Queen:return"\uD83C\uDCCD";case j.King:return"\uD83C\uDCCE";}break;case H.Clubs:switch(this.rank){case j.Ace:return"\uD83C\uDCD1";case j.Two:return"\uD83C\uDCD2";case j.Three:return"\uD83C\uDCD3";case j.Four:return"\uD83C\uDCD4";case j.Five:return"\uD83C\uDCD5";case j.Six:return"\uD83C\uDCD6";case j.Seven:return"\uD83C\uDCD7";case j.Eight:return"\uD83C\uDCD8";case j.Nine:return"\uD83C\uDCD9";case j.Ten:return"\uD83C\uDCDA";case j.Jack:return"\uD83C\uDCDB";case j.Queen:return"\uD83C\uDCDD";case j.King:return"\uD83C\uDCDE";}}return""},e}();var R={};var $a=R&&R.__generator||function(r,t){var e,n,a,i,o={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(i){return function(s){return function(i){if(e)throw new TypeError("Generator is already executing.");for(;o;)try{if(e=1,n&&(a=2&i[0]?n.return:i[0]?n.throw||((a=n.return)&&a.call(n),0):n.next)&&!(a=a.call(n,i[1])).done)return a;switch(n=0,a&&(i=[2&i[0],a.value]),i[0]){case 0:case 1:a=i;break;case 4:return o.label++,{value:i[1],done:!1};case 5:o.label++,n=i[1],i=[0];continue;case 7:i=o.ops.pop(),o.trys.pop();continue;default:if(!(a=(a=o.trys).length>0&&a[a.length-1])&&(6===i[0]||2===i[0])){o=0;continue}if(3===i[0]&&(!a||i[1]>a[0]&&i[1]<a[3])){o.label=i[1];break}if(6===i[0]&&o.label<a[1]){o.label=a[1],a=i;break}if(a&&o.label<a[2]){o.label=a[2],o.ops.push(i);break}a[2]&&o.ops.pop(),o.trys.pop();continue;}i=t.call(r,o)}catch(s){i=[6,s],n=0}finally{e=a=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}},_a=R&&R.__values||function(r){var t="function"==typeof Symbol&&Symbol.iterator,e=t&&r[t],n=0;if(e)return e.call(r);if(r&&"number"==typeof r.length)return{next:function(){return r&&n>=r.length&&(r=void 0),{value:r&&r[n++],done:!r}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")},ab=R&&R.__read||function(r,t){var e="function"==typeof Symbol&&r[Symbol.iterator];if(!e)return r;var n,a,i=e.call(r),o=[];try{for(;(void 0===t||t-->0)&&!(n=i.next()).done;)o.push(n.value)}catch(s){a={error:s}}finally{try{n&&!n.done&&(e=i.return)&&e.call(i)}finally{if(a)throw a.error}}return o},D=function(){function r(r){this.cardsChanged=function(){},this.maxFanChanged=function(){},this.cards_=[],this.maxFan_=1/0,this.game=r}return Object.defineProperty(r.prototype,"length",{get:function(){return this.cards_.length},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"maxFan",{get:function(){return this.maxFan_},set:function(r){var t=this;if(r=Math.max(0,r),this.maxFan_!==r){var e=this.maxFan_,n=function(){t.maxFan_=r,t.maxFanChanged()};this.game.addUndoableOperation(n,function(){t.maxFan_=e,t.maxFanChanged()}),n()}},enumerable:!0,configurable:!0}),r.prototype[Symbol.iterator]=function(){var r,t,e,n,a;return $a(this,function(i){switch(i.label){case 0:i.trys.push([0,5,6,7]),r=_a(this.cards_),t=r.next(),i.label=1;case 1:return t.done?[3,4]:[4,t.value];case 2:i.sent(),i.label=3;case 3:return t=r.next(),[3,1];case 4:return[3,7];case 5:return e=i.sent(),n={error:e},[3,7];case 6:try{t&&!t.done&&(a=r.return)&&a.call(r)}finally{if(n)throw n.error}return[7];case 7:return[2];}})},r.prototype.createCard=function(r,t,e){var n=new Y(this.game,r,t,e,this,this.length-1);return this.cards_.push(n),this.cardsChanged(),n},r.prototype.at=function(r){q.assert(r>=0&&r<this.cards_.length);var t=this.cards_[r];return q.assert(t.pile===this),t},r.prototype.slice=function(r,t){return this.cards_.slice(r,t)},r.prototype.indexOf=function(r){return this.cards_.indexOf(r)},r.prototype.sort=function(){this.cards_.sort(function(r,t){return r.suit<t.suit?-1:r.suit>t.suit?1:r.colour<t.colour?-1:r.colour>t.colour?1:r.rank<t.rank?-1:r.rank>t.rank?1:0});for(var r=0;r<this.cards_.length;++r)this.cards_[r].onPileIndexChanged(r);this.cardsChanged()},r.prototype.shuffle=function(r){for(var t,e=0;e<this.cards_.length;++e){var n;n=(t=ab(Za(e,this.cards_.length-1,r),2))[0],r=t[1];var a=this.cards_[e];this.cards_[e]=this.cards_[n],this.cards_[n]=a}for(e=0;e<this.cards_.length;++e)this.cards_[e].onPileIndexChanged(e);this.cardsChanged()},r.prototype.push=function(r){return this.insert(this.cards_.length,r)},r.prototype.peek=function(){if(!(this.cards_.length<=0))return this.at(this.cards_.length-1)},r.prototype.insert=function(r,t){var e=this,n=t.pile,a=t.pileIndex,i=function(){return e.insert_(r,t)};return this.game.addUndoableOperation(i,function(){return n.insert_(a,t)}),i()},r.prototype.insert_=function(r,t){q.assert(r>=0&&r<=this.cards_.length),t.pile===this&&r>=t.pileIndex&&r--,t.pile.remove_(t),this.cards_.splice(r,0,t),t.onPileChanged(this,r);for(var e=r+1;e<this.cards_.length;++e)this.cards_[e].onPileIndexChanged(e);return this.cardsChanged(),t},r.prototype.remove_=function(r){q.assert(r.pile===this);var t=r.pileIndex;q.assert(this.at(t)===r),this.cards_.splice(t,1);for(var e=t;e<this.cards_.length;++e)this.cards_[e].onPileIndexChanged(e);return this.cardsChanged(),r},r}();R.Pile=D;var oa={},bb=oa&&oa.__values||function(t){var e="function"==typeof Symbol&&Symbol.iterator,o=e&&t[e],r=0;if(o)return o.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&r>=t.length&&(t=void 0),{value:t&&t[r++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")},za=function(){function t(){this.redos_=[],this.undos_=[]}return Object.defineProperty(t.prototype,"length",{get:function(){return this.undos_.length},enumerable:!0,configurable:!0}),t.prototype.addOperation=function(t,e){this.redos_.push(t),this.undos_.push(e)},t.prototype.undo=function(){for(var t=this.undos_.length;t-->0;)this.undos_[t]()},t.prototype.redo=function(){var t,e;try{for(var o=bb(this.redos_),r=o.next();!r.done;r=o.next()){(0,r.value)()}}catch(n){t={error:n}}finally{try{r&&!r.done&&(e=o.return)&&e.call(o)}finally{if(t)throw t.error}}},t}();oa.UndoableOperation=za;var N=ea&&ea.__generator||function(r,t){var e,a,n,o,i={label:0,sent:function(){if(1&n[0])throw n[1];return n[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(e)throw new TypeError("Generator is already executing.");for(;i;)try{if(e=1,a&&(n=2&o[0]?a.return:o[0]?a.throw||((n=a.return)&&n.call(a),0):a.next)&&!(n=n.call(a,o[1])).done)return n;switch(a=0,n&&(o=[2&o[0],n.value]),o[0]){case 0:case 1:n=o;break;case 4:return i.label++,{value:o[1],done:!1};case 5:i.label++,a=o[1],o=[0];continue;case 7:o=i.ops.pop(),i.trys.pop();continue;default:if(!(n=(n=i.trys).length>0&&n[n.length-1])&&(6===o[0]||2===o[0])){i=0;continue}if(3===o[0]&&(!n||o[1]>n[0]&&o[1]<n[3])){i.label=o[1];break}if(6===o[0]&&i.label<n[1]){i.label=n[1],n=o;break}if(n&&i.label<n[2]){i.label=n[2],i.ops.push(o);break}n[2]&&i.ops.pop(),i.trys.pop();continue;}o=t.call(r,i)}catch(s){o=[6,s],a=0}finally{e=n=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}},Z=ea&&ea.__values||function(r){var t="function"==typeof Symbol&&Symbol.iterator,e=t&&r[t],a=0;if(e)return e.call(r);if(r&&"number"==typeof r.length)return{next:function(){return r&&a>=r.length&&(r=void 0),{value:r&&r[a++],done:!r}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")},pa=function(){function r(){this.cards=[],this.piles=[],this.undoStack_=[],this.redoStack_=[],this.currentOperation_=void 0}return r.prototype.restart=function(r){var t;return N(this,function(e){switch(e.label){case 0:return t=Ya(r),this.undoStack_=[],this.redoStack_=[],this.currentOperation_=void 0,[5,Z(this.restart_(t))];case 1:return e.sent(),[2];}})},Object.defineProperty(r.prototype,"canUndo",{get:function(){return this.undoStack_.length>0},enumerable:!0,configurable:!0}),r.prototype.undo=function(){var r;return N(this,function(t){return(r=this.undoStack_.pop())&&(r.undo(),this.redoStack_.push(r)),[2]})},Object.defineProperty(r.prototype,"canRedo",{get:function(){return this.redoStack_.length>0},enumerable:!0,configurable:!0}),r.prototype.redo=function(){var r;return N(this,function(t){return(r=this.redoStack_.pop())&&(r.redo(),this.undoStack_.push(r)),[2]})},r.prototype.getHint=function(){throw new Error("Method not implemented.")},r.prototype.pilePrimary=function(r){return N(this,function(t){switch(t.label){case 0:return this.startOperation_()?(r instanceof D||q.error(),q.assert(this.piles.indexOf(r)>=0),[5,Z(this.pilePrimary_(r))]):[3,2];case 1:t.sent(),this.commitOperation_(),t.label=2;case 2:return[2];}})},r.prototype.pileSecondary=function(r){return N(this,function(t){switch(t.label){case 0:return this.startOperation_()?(r instanceof D||q.error(),q.assert(this.piles.indexOf(r)>=0),[5,Z(this.pileSecondary_(r))]):[3,2];case 1:t.sent(),this.commitOperation_(),t.label=2;case 2:return[2];}})},r.prototype.cardPrimary=function(r){return N(this,function(t){switch(t.label){case 0:return this.startOperation_()?(r instanceof Y||q.error(),q.assert(this.cards.indexOf(r)>=0),[5,Z(this.cardPrimary_(r))]):[3,2];case 1:t.sent(),this.commitOperation_(),t.label=2;case 2:return[2];}})},r.prototype.cardSecondary=function(r){return N(this,function(t){switch(t.label){case 0:return this.startOperation_()?(r instanceof Y||q.error(),q.assert(this.cards.indexOf(r)>=0),[5,Z(this.cardSecondary_(r))]):[3,2];case 1:t.sent(),this.commitOperation_(),t.label=2;case 2:return[2];}})},r.prototype.canDrag=function(r){return r instanceof Y||q.error(),q.assert(this.cards.indexOf(r)>=0),this.canDrag_(r)},r.prototype.previewDrop=function(r,t){return r instanceof Y||q.error(),t instanceof D||q.error(),q.assert(this.cards.indexOf(r)>=0),q.assert(this.piles.indexOf(t)>=0),this.previewDrop_(r,t)},r.prototype.dropCard=function(r,t){return N(this,function(e){switch(e.label){case 0:return this.startOperation_()?(r instanceof Y||q.error(),t instanceof D||q.error(),q.assert(this.cards.indexOf(r)>=0),q.assert(this.piles.indexOf(t)>=0),[5,Z(this.dropCard_(r,t))]):[3,2];case 1:e.sent(),this.commitOperation_(),e.label=2;case 2:return[2];}})},r.prototype.startOperation_=function(){return!this.currentOperation_&&(this.currentOperation_=new za,!0)},r.prototype.addUndoableOperation=function(r,t){this.currentOperation_&&this.currentOperation_.addOperation(r,t)},r.prototype.commitOperation_=function(){this.currentOperation_||q.error(),this.currentOperation_.length>0&&(this.undoStack_.push(this.currentOperation_),this.redoStack_=[]),this.currentOperation_=void 0},r}();ea.GameBase=pa;var cb=Q&&Q.__extends||function(){var e=function(r,t){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,r){e.__proto__=r}||function(e,r){for(var t in r)r.hasOwnProperty(t)&&(e[t]=r[t])})(r,t)};return function(r,t){function n(){this.constructor=r}e(r,t),r.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}}(),E=Q&&Q.__generator||function(e,r){var t,n,a,o,s={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return o={next:i(0),throw:i(1),return:i(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function i(o){return function(i){return function(o){if(t)throw new TypeError("Generator is already executing.");for(;s;)try{if(t=1,n&&(a=2&o[0]?n.return:o[0]?n.throw||((a=n.return)&&a.call(n),0):n.next)&&!(a=a.call(n,o[1])).done)return a;switch(n=0,a&&(o=[2&o[0],a.value]),o[0]){case 0:case 1:a=o;break;case 4:return s.label++,{value:o[1],done:!1};case 5:s.label++,n=o[1],o=[0];continue;case 7:o=s.ops.pop(),s.trys.pop();continue;default:if(!(a=(a=s.trys).length>0&&a[a.length-1])&&(6===o[0]||2===o[0])){s=0;continue}if(3===o[0]&&(!a||o[1]>a[0]&&o[1]<a[3])){s.label=o[1];break}if(6===o[0]&&s.label<a[1]){s.label=a[1],a=o;break}if(a&&s.label<a[2]){s.label=a[2],s.ops.push(o);break}a[2]&&s.ops.pop(),s.trys.pop();continue;}o=r.call(e,s)}catch(i){o=[6,i],n=0}finally{t=a=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,i])}}},A=Q&&Q.__values||function(e){var r="function"==typeof Symbol&&Symbol.iterator,t=r&&e[r],n=0;if(t)return t.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}};throw new TypeError(r?"Object is not iterable.":"Symbol.iterator is not defined.")},db=7,Aa=function(e){function r(r){var t=e.call(this)||this;t.stock=new D(t),t.waste=new D(t),t.foundations=[],t.tableaux=[],t.dragSingleSources_=[],t.autoMoveSources_=[],t.restocks_=0,t.options=r,t.piles.push(t.stock),t.piles.push(t.waste),t.dragSingleSources_.push(t.waste),t.autoMoveSources_.push(t.waste);for(var n=0;n<4;++n){var a=new D(t);t.foundations.push(a),t.dragSingleSources_.push(a),t.piles.push(a)}for(n=0;n<db;++n){a=new D(t);t.tableaux.push(a),t.dragSingleSources_.push(a),t.autoMoveSources_.push(a),t.piles.push(a)}return t.cards=na.createStandard52Deck(t.stock),t}return cb(r,e),r.prototype.restart_=function(e){var r,t,n,a,o,s,i,u,l,c;return E(this,function($){switch($.label){case 0:this.restocks_=0;try{for(r=A(this.stock),t=r.next();!t.done;t=r.next())(u=t.value).flip(!1)}catch(p){l={error:p}}finally{try{t&&!t.done&&(c=r.return)&&c.call(r)}finally{if(l)throw l.error}}for(n=this.piles.length;n-->0;)if((s=this.piles[n])!==this.stock)for(a=s.length;a-->0;)(u=s.at(a)).flip(!1),this.stock.push(u);return this.stock.sort(),this.stock.shuffle(e),[4,z.Settle];case 1:$.sent(),o=0,$.label=2;case 2:if(!(o<this.tableaux.length))return[3,7];s=this.tableaux[o],i=0,$.label=3;case 3:return i<=o?(u=this.stock.peek())?(s.push(u),[4,z.Quick]):[3,5]:[3,6];case 4:$.sent(),$.label=5;case 5:return++i,[3,3];case 6:return++o,[3,2];case 7:return[4,z.OneByOne];case 8:return $.sent(),[5,A(this.doAutoMoves_())];case 9:return $.sent(),[2];}})},r.prototype.cardPrimary_=function(e){return E(this,function(r){switch(r.label){case 0:return this.stock.peek()===e&&this.canDrawFromStock_()?[5,A(this.doDrawFromStock_())]:[3,3];case 1:return r.sent(),[5,A(this.doAutoMoves_())];case 2:return r.sent(),[2];case 3:return this.tableaux.indexOf(e.pile)?e.pile.peek()!==e||e.faceUp?[3,6]:(e.flip(!0),[4,z.Quick]):[3,6];case 4:return r.sent(),[5,A(this.doAutoMoves_())];case 5:return r.sent(),[2];case 6:return[2];}})},r.prototype.cardSecondary_=function(e){var r,t,n,a,o,s;return E(this,function(i){switch(i.label){case 0:if(!(this.autoMoveSources_.indexOf(e.pile)>=0))return[3,9];i.label=1;case 1:i.trys.push([1,7,8,9]),r=A(this.foundations),t=r.next(),i.label=2;case 2:return t.done?[3,6]:(n=t.value,this.isFoundationDrop_(e,n)?(n.push(e),[4,z.OneByOne]):[3,5]);case 3:return i.sent(),[5,A(this.doAutoMoves_())];case 4:return i.sent(),[2];case 5:return t=r.next(),[3,2];case 6:return[3,9];case 7:return a=i.sent(),o={error:a},[3,9];case 8:try{t&&!t.done&&(s=r.return)&&s.call(r)}finally{if(o)throw o.error}return[7];case 9:return[2];}})},r.prototype.pilePrimary_=function(e){var r,t;return E(this,function(n){switch(n.label){case 0:if(!(e===this.stock&&0===this.stock.length&&this.waste.length>0&&this.restocks_<this.options.restocksAllowed))return[3,4];for(this.restocks_++,r=this.waste.length;r-->0;)(t=this.waste.at(r)).flip(!1);return this.waste.maxFan=0,[4,z.OneByOne];case 1:for(n.sent(),r=this.waste.length;r-->0;)t=this.waste.at(r),this.stock.push(t);return[4,z.OneByOne];case 2:return n.sent(),[5,A(this.doAutoMoves_())];case 3:return n.sent(),[2];case 4:return[2];}})},r.prototype.pileSecondary_=function(e){return E(this,function(e){return[2]})},r.prototype.canDrag_=function(e){return this.isFoundationDropSource_(e)?{canDrag:!0,extraCards:[]}:this.isTableauxDropSource_(e)?{canDrag:!0,extraCards:e.pile.slice(e.pileIndex+1)}:{canDrag:!1,extraCards:[]}},r.prototype.previewDrop_=function(e,r){return this.isTableauxDrop_(e,r)||this.isFoundationDrop_(e,r)},r.prototype.dropCard_=function(e,r){return E(this,function(t){switch(t.label){case 0:return this.isTableauxDrop_(e,r)?[5,A(this.doTableauxDrop_(e,r))]:[3,3];case 1:return t.sent(),[5,A(this.doAutoMoves_())];case 2:return t.sent(),[3,6];case 3:return this.isFoundationDrop_(e,r)?[5,A(this.doFoundationDrop_(e,r))]:[3,6];case 4:return t.sent(),[5,A(this.doAutoMoves_())];case 5:t.sent(),t.label=6;case 6:return[2];}})},r.prototype.canDrawFromStock_=function(){return this.stock.length>0},r.prototype.doDrawFromStock_=function(){var e,r;return E(this,function(t){switch(t.label){case 0:this.waste.maxFan=0,e=0,t.label=1;case 1:return e<this.options.stockDraws?(r=this.stock.peek())?(this.waste.push(r),this.waste.maxFan++,[4,z.Quick]):[3,4]:[3,5];case 2:return t.sent(),r.flip(!0),[4,z.Quick];case 3:t.sent(),t.label=4;case 4:return++e,[3,1];case 5:return[2];}})},r.prototype.isTableauxDrop_=function(e,r){if(e.pile===r)return!1;if(!this.isTableauxDropSource_(e))return!1;if(this.tableaux.indexOf(r)>=0){var t=r.peek();if(t){if(this.getCardValue_(t)===this.getCardValue_(e)+1&&t.colour!==e.colour)return!0}else if(e.rank===j.King)return!0}return!1},r.prototype.isTableauxDropSource_=function(e){var r;if(this.dragSingleSources_.indexOf(e.pile)>=0&&e.pile.peek()===e&&e.faceUp)return!0;if(this.tableaux.indexOf(e.pile)>=0&&(null===(r=e.pile.peek())||void 0===r?void 0:r.faceUp))for(var t=e.pile.length-1;t-->0;){var n=e.pile.at(t),a=e.pile.at(t+1);if(!((null==n?void 0:n.faceUp)&&(null==a?void 0:a.faceUp)&&n.colour!==a.colour&&this.getCardValue_(a)===this.getCardValue_(n)-1))return!1;if(n===e)return!0}return!1},r.prototype.doTableauxDrop_=function(e,r){var t,n,a,o,s,i,u;return E(this,function(l){switch(l.label){case 0:t=e.pile,n=e.pile.slice(e.pileIndex);try{for(a=A(n),o=a.next();!o.done;o=a.next())s=o.value,r.push(s)}catch(c){i={error:c}}finally{try{o&&!o.done&&(u=a.return)&&u.call(a)}finally{if(i)throw i.error}}return t===this.waste&&this.waste.maxFan--,[4,z.OneByOne];case 1:return l.sent(),[2];}})},r.prototype.isFoundationDrop_=function(e,r){if(e.pile===r)return!1;if(!this.isFoundationDropSource_(e))return!1;if(this.foundations.indexOf(r)>=0){var t=r.peek();if(t){if(this.getCardValue_(t)+1===this.getCardValue_(e)&&t.suit===e.suit)return!0}else if(e.rank===j.Ace)return!0}return!1},r.prototype.isFoundationDropSource_=function(e){return this.dragSingleSources_.indexOf(e.pile)>=0&&e.pile.peek()===e&&e.faceUp},r.prototype.doFoundationDrop_=function(e,r){var t;return E(this,function(n){switch(n.label){case 0:return t=e.pile,r.push(e),t===this.waste&&this.waste.maxFan--,[4,z.OneByOne];case 1:return n.sent(),[2];}})},r.prototype.getCardValue_=function(e){switch(e.rank){case j.Ace:return 1;case j.Two:return 2;case j.Three:return 3;case j.Four:return 4;case j.Five:return 5;case j.Six:return 6;case j.Seven:return 7;case j.Eight:return 8;case j.Nine:return 9;case j.Ten:return 10;case j.Jack:return 11;case j.Queen:return 12;case j.King:return 13;default:q.error();}},r.prototype.doAutoMoves_=function(){var e,r,t,n,a,o,s,i,u,l,c,$,p,h,f,_,w,d,v,T,L,y,k,b;return E(this,function(x){switch(x.label){case 0:if(!this.options.autoReveal)return[3,8];x.label=1;case 1:x.trys.push([1,6,7,8]),w=void 0,e=A(this.tableaux),r=e.next(),x.label=2;case 2:return r.done?[3,5]:(t=r.value,!(c=t.peek())||c.faceUp?[3,4]:[4,z.Quick]);case 3:return x.sent(),c.flip(!0),[3,0];case 4:return r=e.next(),[3,2];case 5:return[3,8];case 6:return n=x.sent(),w={error:n},[3,8];case 7:try{r&&!r.done&&(d=e.return)&&d.call(e)}finally{if(w)throw w.error}return[7];case 8:if(!(this.options.autoMoveToFoundation>0))return[3,22];a=999;try{for(v=void 0,o=A(this.foundations),s=o.next();!s.done;s=o.next())l=s.value,c=l.peek(),a=c?Math.min(a,this.getCardValue_(c)):Math.min(a,0)}catch(m){v={error:m}}finally{try{s&&!s.done&&(T=o.return)&&T.call(o)}finally{if(v)throw v.error}}x.label=9;case 9:x.trys.push([9,20,21,22]),L=void 0,i=A(this.autoMoveSources_),u=i.next(),x.label=10;case 10:if(u.done)return[3,19];if(l=u.value,!(c=l.peek()))return[3,18];x.label=11;case 11:x.trys.push([11,16,17,18]),k=void 0,$=A(this.foundations),p=$.next(),x.label=12;case 12:return p.done?[3,15]:(h=p.value,this.isFoundationDrop_(c,h)?[5,A(this.doFoundationDrop_(c,h))]:[3,14]);case 13:return x.sent(),[3,0];case 14:return p=$.next(),[3,12];case 15:return[3,18];case 16:return f=x.sent(),k={error:f},[3,18];case 17:try{p&&!p.done&&(b=$.return)&&b.call($)}finally{if(k)throw k.error}return[7];case 18:return u=i.next(),[3,10];case 19:return[3,22];case 20:return _=x.sent(),L={error:_},[3,22];case 21:try{u&&!u.done&&(y=i.return)&&y.call(i)}finally{if(L)throw L.error}return[7];case 22:return this.options.autoPlayStock&&0===this.waste.length&&this.canDrawFromStock_()?[5,A(this.doDrawFromStock_())]:[3,24];case 23:return x.sent(),[3,0];case 24:return[3,25];case 25:return[2];}})},r}(pa);Q.Game=Aa;var qa={};var eb=function(){function t(){}return t.clamp=function(t,$,r){return t<=$?$:t>=r?r:t},t}();var Ba=function(){function t(t){this.params_=t}return t.prototype.getFloat_=function(t,r){var e=this.params_.get(t);if(null==e||""===e)return r;var a=Number(e);return Number.isNaN(a)?r:a},t.prototype.getInt_=function(t,r){var e=this.params_.get(t);if(null==e||""===e)return r;var a=Number(e);return Number.isNaN(a)||!Number.isInteger(a)?r:a},t.prototype.getBool_=function(t,r){var e=this.params_.get(t);return null==e?r:""===e||!!this.params_.get(t)},t}();var fb=qa&&qa.__extends||function(){var t=function(o,e){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,o){t.__proto__=o}||function(t,o){for(var e in o)o.hasOwnProperty(e)&&(t[e]=o[e])})(o,e)};return function(o,e){function a(){this.constructor=o}t(o,e),o.prototype=null===e?Object.create(e):(a.prototype=e.prototype,new a)}}(),Ca=function(t){function o(o){var e=t.call(this,o)||this;return e.stockDraws=1,e.restocksAllowed=1/0,e.autoReveal=!0,e.autoPlayStock=!0,e.autoMoveToFoundation=2,e.stockDraws=eb.clamp(e.getFloat_("stockDraws",1),1,3),e.restocksAllowed=e.getFloat_("restocksAllowed",1/0),e.autoReveal=e.getBool_("autoReveal",!0),e.autoPlayStock=e.getBool_("autoPlayStock",!0),e.autoMoveToFoundation=Math.max(0,e.getInt_("autoMoveToFoundation",2)),e}return fb(o,t),o}(Ba);qa.GameOptions=Ca;var fa={};var S={};var ra={};var B=function(){function t(t,i,e,s){void 0===t&&(t=0),void 0===i&&(i=0),void 0===e&&(e=0),void 0===s&&(s=0),this.sizeX=t,this.sizeY=i,this.x=e,this.y=s}return Object.defineProperty(t.prototype,"xMin",{get:function(){return this.x-.5*this.sizeX},set:function(t){var i=this.xMax;this.sizeX=i-t,this.x=.5*t+.5*i},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"xMax",{get:function(){return this.x+.5*this.sizeX},set:function(t){var i=this.xMin;this.sizeX=t-i,this.x=.5*i+.5*t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"yMin",{get:function(){return this.y-.5*this.sizeY},set:function(t){var i=this.yMax;this.sizeX=i-t,this.y=.5*t+.5*i},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"yMax",{get:function(){return this.y+.5*this.sizeY},set:function(t){var i=this.yMin;this.sizeX=t-i,this.y=.5*i+.5*t},enumerable:!0,configurable:!0}),t.prototype.set=function(t){return!this.equals(t)&&(this.x=t.x,this.y=t.y,this.sizeX=t.sizeX,this.sizeY=t.sizeY,!0)},t.prototype.setOnElement=function(t){t.style.left="calc(50% + "+(this.x-.5*this.sizeX)+"em)",t.style.right="calc(50% + "+(-this.x-.5*this.sizeX)+"em)",t.style.top="calc(50% + "+(this.y-.5*this.sizeY)+"em)",t.style.bottom="calc(50% + "+(-this.y-.5*this.sizeY)+"em)"},t.prototype.equals=function(t){return this.x===t.x&&this.y===t.y&&this.sizeX===t.sizeX&&this.sizeY===t.sizeY},t.prototype.overlaps=function(t){var i=Math.min(this.xMax,t.xMax)-Math.max(this.xMin,t.xMin);if(i<=0)return 0;var e=Math.min(this.yMax,t.yMax)-Math.max(this.yMin,t.yMin);return e<=0?0:i*e},t}();var sa=ra&&ra.__values||function(t){var e="function"==typeof Symbol&&Symbol.iterator,r=e&&t[e],i=0;if(r)return r.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&i>=t.length&&(t=void 0),{value:t&&t[i++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")},Da=function(){function t(t,e,r,i){var n=this;this.click=function(){},this.dblClick=function(){},this.dragStart=function(){return{canDrag:!1,extraCardViews:[]}},this.dragMoved=function(t){},this.dragEnd=function(t,e){},this.rect_=new B,this.zIndex_=0,this.faceUp_=!1,this.dropPreview_=!1,this.touchTracking_=!1,this.touchId_=0,this.touchInDeadZone_=!1,this.touchStartX_=0,this.touchStartY_=0,this.lastTouchEndTimeStamp_=0,this.dragging_=!1,this.dragExtraCardViews_=[],this.dragRect_=new B,this.onMouseDown_=function(t){0===t.button&&(t.preventDefault(),n.context.addTouchResponder(n),n.onTouchDown(-1,t.pageX,t.pageY,t.timeStamp))},this.touchStart_=function(t){for(var e=0;e<t.changedTouches.length;++e){var r=t.changedTouches.item(e);r&&(t.preventDefault(),n.context.addTouchResponder(n),n.onTouchDown(r.identifier,r.pageX,r.pageY,t.timeStamp))}},this.context=t.context,this.element=ma.instantiateTemplate(t.element,"cardViewTemplate"),this.element.classList.add("s"+e+"c"+r+"r"+i),this.element.addEventListener("mousedown",this.onMouseDown_),this.element.addEventListener("touchstart",this.touchStart_)}return Object.defineProperty(t.prototype,"rect",{get:function(){var t=new B;return t.set(this.rect_),t},set:function(t){this.rect_.set(t)&&t.setOnElement(this.element)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"zIndex",{get:function(){return this.zIndex_},set:function(t){this.zIndex_!==t&&(this.zIndex_=t,this.element.style.zIndex=""+t)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"faceUp",{get:function(){return this.faceUp_},set:function(t){this.faceUp_!==t&&(this.faceUp_=t,t?this.element.classList.add("faceUp"):this.element.classList.remove("faceUp"))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"dropPreview",{get:function(){return this.dropPreview_},set:function(t){this.dropPreview_!==t&&(this.dropPreview_=t,t?this.element.classList.add("dropPreview"):this.element.classList.remove("dropPreview"))},enumerable:!0,configurable:!0}),t.prototype.dispose=function(){this.element.remove()},t.prototype.onTouchDown=function(t,e,r,i){this.touchTracking_||(this.touchId_=t,this.touchTracking_=!0,this.touchInDeadZone_=!0,this.touchStartX_=e,this.touchStartY_=r,this.dragging_=!1)},t.prototype.onTouchMoved=function(t,e,r,i){var n,o;if(this.touchTracking_&&this.touchId_===t){var a=e-this.touchStartX_,s=r-this.touchStartY_;if(this.touchInDeadZone_){var h=a*a+s*s;if(h>M.TOUCH_DEADZONE_SQ){var c=Math.sqrt(h);a/=c,s/=c,this.touchStartX_+=M.TOUCH_DEADZONE*a,this.touchStartY_+=M.TOUCH_DEADZONE*s,this.touchInDeadZone_=!1,this.startDragging_()}}if(this.dragging_){this.touchStartX_=e,this.touchStartY_=r;var d=this.context.pxPerRem;this.dragRect_.x+=d*a,this.dragRect_.y+=d*s,this.dragRect_.setOnElement(this.element);try{for(var u=sa(this.dragExtraCardViews_),l=u.next();!l.done;l=u.next()){var g=l.value;g.dragRect_.x+=d*a,g.dragRect_.y+=d*s,g.dragRect_.setOnElement(g.element)}}catch(_){n={error:_}}finally{try{l&&!l.done&&(o=u.return)&&o.call(u)}finally{if(n)throw n.error}}this.dragMoved(this.dragRect_)}}},t.prototype.onTouchUp=function(t,e,r){this.touchTracking_&&this.touchId_===t&&(this.touchTracking_=!1,this.context.removeTouchResponder(this),this.touchInDeadZone_?(r<this.lastTouchEndTimeStamp_+1e3?this.dblClick():(this.lastTouchEndTimeStamp_=r,this.click()),this.stopDragging_(!0)):this.stopDragging_(!1))},t.prototype.startDragging_=function(){var t,e,r=this.dragStart(),i=r.canDrag,n=r.extraCardViews;if(i){this.dragging_=!0,this.dragExtraCardViews_=n,this.dragRect_.set(this.rect_),this.element.classList.add("dragging");try{for(var o=sa(this.dragExtraCardViews_),a=o.next();!a.done;a=o.next()){var s=a.value;s.dragRect_.set(s.rect_),s.element.classList.add("dragging")}}catch(h){t={error:h}}finally{try{a&&!a.done&&(e=o.return)&&e.call(o)}finally{if(t)throw t.error}}}},t.prototype.stopDragging_=function(t){var e,r;if(this.dragging_){this.dragging_=!1,this.element.classList.remove("dragging"),this.rect_.setOnElement(this.element);try{for(var i=sa(this.dragExtraCardViews_),n=i.next();!n.done;n=i.next()){var o=n.value;o.element.classList.remove("dragging"),o.rect_.setOnElement(o.element)}}catch(a){e={error:a}}finally{try{n&&!n.done&&(r=i.return)&&r.call(i)}finally{if(e)throw e.error}}this.dragEnd(this.dragRect_,t)}},t}();ra.CardView=Da;var gb=function(){function t(t){var e=this;this.click=function(){},this.dblClick=function(){},this.fanXDown=0,this.fanXUp=0,this.fanYDown=0,this.fanYUp=0,this.cardCount=0,this.rect_=new B,this.hitbox_=new B,this.zIndex_=0,this.showFrame_=!1,this.dropPreview_=!1,this.touchTracking_=!1,this.touchId_=0,this.touchInDeadZone_=!1,this.touchStartX_=0,this.touchStartY_=0,this.lastTouchEndTimeStamp_=0,this.onMouseDown_=function(t){0===t.button&&(t.preventDefault(),e.context.addTouchResponder(e),e.onTouchDown(-1,t.pageX,t.pageY,t.timeStamp))},this.touchStart_=function(t){for(var i=0;i<t.changedTouches.length;++i){var o=t.changedTouches.item(i);o&&(t.preventDefault(),e.context.addTouchResponder(e),e.onTouchDown(o.identifier,o.pageX,o.pageY,t.timeStamp))}},this.context=t.context,this.element=ma.instantiateTemplate(t.element,"pileViewTemplate"),this.element.addEventListener("mousedown",this.onMouseDown_),this.element.addEventListener("touchstart",this.touchStart_)}return Object.defineProperty(t.prototype,"rect",{get:function(){var t=new B;return t.set(this.rect_),t},set:function(t){this.rect_.set(t)&&t.setOnElement(this.element)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"hitbox",{get:function(){var t=new B;return t.set(this.hitbox_),t},set:function(t){this.hitbox_.set(t)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"zIndex",{get:function(){return this.zIndex_},set:function(t){this.zIndex_!==t&&(this.zIndex_=t,this.element.style.zIndex=""+t)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"showFrame",{get:function(){return this.showFrame_},set:function(t){this.showFrame_!==t&&(this.showFrame_=t,t?this.element.classList.add("showFrame"):this.element.classList.remove("showFrame"))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"dropPreview",{get:function(){return this.dropPreview_},set:function(t){this.dropPreview_!==t&&(this.dropPreview_=t,t?this.element.classList.add("dropPreview"):this.element.classList.remove("dropPreview"))},enumerable:!0,configurable:!0}),t.prototype.dispose=function(){this.element.remove()},t.prototype.onTouchDown=function(t,e,i,o){this.touchTracking_||(this.touchId_=t,this.touchTracking_=!0,this.touchInDeadZone_=!0,this.touchStartX_=e,this.touchStartY_=i)},t.prototype.onTouchMoved=function(t,e,i,o){if(this.touchTracking_&&this.touchId_===t){var n=e-this.touchStartX_,r=i-this.touchStartY_;if(this.touchInDeadZone_){var h=n*n+r*r;if(h>M.TOUCH_DEADZONE_SQ){var s=Math.sqrt(h);n/=s,r/=s,this.touchStartX_+=M.TOUCH_DEADZONE*n,this.touchStartY_+=M.TOUCH_DEADZONE*r,this.touchInDeadZone_=!1}}}},t.prototype.onTouchUp=function(t,e,i){this.touchTracking_&&this.touchId_===t&&(this.touchTracking_=!1,this.context.removeTouchResponder(this),this.touchInDeadZone_&&(i<this.lastTouchEndTimeStamp_+1e3?(this.dblClick(),this.lastTouchEndTimeStamp_=i):this.click()))},t}();var J=S&&S.__awaiter||function(e,r,t,n){return new(t||(t=Promise))(function(i,o){function a(e){try{s(n.next(e))}catch(r){o(r)}}function u(e){try{s(n.throw(e))}catch(r){o(r)}}function s(e){var r;e.done?i(e.value):(r=e.value,r instanceof t?r:new t(function(e){e(r)})).then(a,u)}s((n=n.apply(e,r||[])).next())})},K=S&&S.__generator||function(e,r){var t,n,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:u(0),throw:u(1),return:u(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function u(o){return function(u){return function(o){if(t)throw new TypeError("Generator is already executing.");for(;a;)try{if(t=1,n&&(i=2&o[0]?n.return:o[0]?n.throw||((i=n.return)&&i.call(n),0):n.next)&&!(i=i.call(n,o[1])).done)return i;switch(n=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,n=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(i=(i=a.trys).length>0&&i[i.length-1])&&(6===o[0]||2===o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue;}o=r.call(e,a)}catch(u){o=[6,u],n=0}finally{t=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,u])}}},ta=S&&S.__values||function(e){var r="function"==typeof Symbol&&Symbol.iterator,t=r&&e[r],n=0;if(t)return t.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}};throw new TypeError(r?"Object is not iterable.":"Symbol.iterator is not defined.")},ua=function(){function e(e,r){var t,n,i,o=this;this.pileViews_=[],this.pileToPileView_=new Map,this.pileViewtoPile_=new Map,this.cardViews_=[],this.cardToCardView_=new Map,this.cardViewtoCard_=new Map,this.dropPreview_=void 0,this.nextZIndex_=1e3,this.nextZIndexInc_=1,this.onWindowResize_=function(e){o.onResize_()},this.onWindowKeyDown_=function(e){e&&("y"===e.key&&e.ctrlKey?(o.redo_(),e.stopPropagation(),e.preventDefault()):"z"===e.key&&e.ctrlKey?(o.undo_(),e.stopPropagation(),e.preventDefault()):"n"===e.key&&(o.restart_(),e.stopPropagation(),e.preventDefault()))},this.operations_=[],this.game_=e,this.rootView_=r,null===(t=document.getElementById("newGameButton"))||void 0===t||t.addEventListener("click",function(e){e.preventDefault(),o.restart_()}),null===(n=document.getElementById("undoButton"))||void 0===n||n.addEventListener("click",function(e){e.preventDefault(),o.undo_()}),null===(i=document.getElementById("redoButton"))||void 0===i||i.addEventListener("click",function(e){e.preventDefault(),o.redo_()}),window.addEventListener("resize",this.onWindowResize_),window.addEventListener("keydown",this.onWindowKeyDown_),this.restart_()}return e.prototype.dispose=function(){this.rootView_.dispose()},e.prototype.createPileView_=function(e){var r=this,t=new gb(this.rootView_);return this.pileViews_.push(t),this.pileToPileView_.set(e,t),this.pileViewtoPile_.set(t,e),e.cardsChanged=function(){return r.onPileCardsChanged_(t,e)},e.maxFanChanged=function(){return r.onPileMaxFanChanged_(t,e)},t.click=function(){return r.pilePrimary_(e)},t.dblClick=function(){return r.pileSecondary_(e)},t},e.prototype.getPile_=function(e){var r=this.pileViewtoPile_.get(e);return r||q.error(),r},e.prototype.getPileView_=function(e){var r=this.pileToPileView_.get(e);return r||q.error(),r},e.prototype.onPileCardsChanged_=function(e,r){this.relayoutPile_(e,r)},e.prototype.onPileMaxFanChanged_=function(e,r){this.relayoutPile_(e,r)},e.prototype.relayoutPile_=function(e,r){var t;e.cardCount=r.length;for(var n=r.length;n-->0;){var i=r.at(n),o=this.getCardView_(i);t?o.zIndex=--t:t=o.zIndex}var a=r.length-r.maxFan,u=0,s=0,c=0,d=0;for(n=0;n<r.length;++n){i=r.at(n),o=this.getCardView_(i);var p=e.rect;u=c,s=d,p.x+=c,p.y+=d,n>=a&&(i.faceUp?(c+=e.fanXUp,d+=e.fanYUp):(c+=e.fanXDown,d+=e.fanYDown)),o.rect=p}var _=e.rect;_.x+=.5*u,_.y+=.5*s,_.sizeX+=u,_.sizeY+=s,e.hitbox=_},e.prototype.createCardView_=function(e){var r=this,t=new Da(this.rootView_,e.suit,e.colour,e.rank);return this.cardViews_.push(t),this.cardToCardView_.set(e,t),this.cardViewtoCard_.set(t,e),this.onCardPileChanged_(t,e),e.pileChanged=function(){return r.onCardPileChanged_(t,e)},this.onCardPileIndexChanged_(t,e),e.pileIndexChanged=function(){return r.onCardPileIndexChanged_(t,e)},this.onCardFaceUpChanged_(t,e),e.faceUpChanged=function(){return r.onCardFaceUpChanged_(t,e)},t.click=function(){return r.cardPrimary_(e)},t.dblClick=function(){return r.cardSecondary_(e)},t.dragStart=function(){return r.cardDragStart_(t,e)},t.dragMoved=function(n){return r.cardDragMoved_(t,e,n)},t.dragEnd=function(n,i){return r.cardDragEnd_(t,e,n,i)},t},e.prototype.getCard_=function(e){var r=this.cardViewtoCard_.get(e);return r||q.error(),r},e.prototype.getCardView_=function(e){var r=this.cardToCardView_.get(e);return r||q.error(),r},e.prototype.onCardPileChanged_=function(e,r){e.zIndex=this.getNextZIndex_()},e.prototype.onCardPileIndexChanged_=function(e,r){},e.prototype.onCardFaceUpChanged_=function(e,r){e.faceUp=r.faceUp},e.prototype.cardDragStart_=function(e,r){var t,n,i=this.game_.canDrag(r),o=i.canDrag,a=i.extraCards;o&&(e.zIndex=this.getNextZIndex_());var u=[];try{for(var s=ta(a),c=s.next();!c.done;c=s.next()){var d=c.value,p=this.getCardView_(d);u.push(p),o&&(p.zIndex=this.getNextZIndex_())}}catch(_){t={error:_}}finally{try{c&&!c.done&&(n=s.return)&&n.call(s)}finally{if(t)throw t.error}}return{canDrag:o,extraCardViews:u}},e.prototype.cardDragMoved_=function(e,r,t){var n=this.getBestDragPile_(r,t);if(n){var i=n.peek();if(i){var o=this.getCardView_(i);return void this.setDropPreview_(o)}var a=this.getPileView_(n);this.setDropPreview_(a)}else this.setDropPreview_(void 0)},e.prototype.cardDragEnd_=function(e,r,t,n){var i=this;if(!n){var o=this.getBestDragPile_(r,t);o&&this.addOperation_(function(){return i.game_.dropCard(r,o)})}this.setDropPreview_(void 0)},e.prototype.getBestDragPile_=function(e,r){var t,n,i,o=0;try{for(var a=ta(this.pileViews_),u=a.next();!u.done;u=a.next()){var s=u.value,c=this.getPile_(s),d=s.hitbox,p=r.overlaps(d);p<=0||(!i||o<p)&&this.game_.previewDrop(e,c)&&(i=c,o=p)}}catch(_){t={error:_}}finally{try{u&&!u.done&&(n=a.return)&&n.call(a)}finally{if(t)throw t.error}}return i},e.prototype.setDropPreview_=function(e){e!==this.dropPreview_&&(this.dropPreview_&&(this.dropPreview_.dropPreview=!1),this.dropPreview_=e,this.dropPreview_&&(this.dropPreview_.dropPreview=!0))},e.prototype.getNextZIndex_=function(){var e=this.nextZIndex_;return this.nextZIndex_+=this.nextZIndexInc_,e},e.prototype.undo_=function(){return J(this,void 0,void 0,function(){var e=this;return K(this,function(r){return this.addOperation_(function(){return e.game_.undo()}),[2]})})},e.prototype.redo_=function(){return J(this,void 0,void 0,function(){var e=this;return K(this,function(r){return this.addOperation_(function(){return e.game_.redo()}),[2]})})},e.prototype.restart_=function(){return J(this,void 0,void 0,function(){var e=this;return K(this,function(r){return this.addOperation_(function(){return e.game_.restart(Date.now())}),[2]})})},e.prototype.pilePrimary_=function(e){return J(this,void 0,void 0,function(){var r=this;return K(this,function(t){return this.addOperation_(function(){return r.game_.pilePrimary(e)}),[2]})})},e.prototype.pileSecondary_=function(e){return J(this,void 0,void 0,function(){var r=this;return K(this,function(t){return this.addOperation_(function(){return r.game_.pileSecondary(e)}),[2]})})},e.prototype.cardPrimary_=function(e){return J(this,void 0,void 0,function(){var r=this;return K(this,function(t){return this.addOperation_(function(){return r.game_.cardPrimary(e)}),[2]})})},e.prototype.cardSecondary_=function(e){return J(this,void 0,void 0,function(){var r=this;return K(this,function(t){return this.addOperation_(function(){return r.game_.cardSecondary(e)}),[2]})})},e.prototype.addOperation_=function(e){return J(this,void 0,void 0,function(){var r,t,n,i,o,a,u,s;return K(this,function(c){switch(c.label){case 0:if(r=0,0!==this.operations_.length)return[3,11];this.operations_.push(e),c.label=1;case 1:if(!(this.operations_.length>0))return[3,10];t=this.operations_[0],c.label=2;case 2:c.trys.push([2,7,8,9]),u=void 0,n=ta(t()),i=n.next(),c.label=3;case 3:return i.done?[3,6]:(o=i.value,[4,this.waitForDelay_(o,r++)]);case 4:c.sent(),c.label=5;case 5:return i=n.next(),[3,3];case 6:return[3,9];case 7:return a=c.sent(),u={error:a},[3,9];case 8:try{i&&!i.done&&(s=n.return)&&s.call(n)}finally{if(u)throw u.error}return[7];case 9:return this.operations_.shift(),[3,1];case 10:return[3,12];case 11:this.operations_.push(e),c.label=12;case 12:return[2];}})})},e.prototype.waitForDelay_=function(e,r){return J(this,void 0,void 0,function(){var t;return K(this,function(n){switch(n.label){case 0:switch(t=Math.pow(.95,r),e){case z.None:return[3,1];case z.Quick:return[3,2];case z.OneByOne:return[3,4];case z.Settle:return[3,6];}return[3,8];case 1:return[2];case 2:return[4,new Promise(function(e){return setTimeout(e,20*t)})];case 3:return n.sent(),[2];case 4:return[4,new Promise(function(e){return setTimeout(e,200*t)})];case 5:return n.sent(),[2];case 6:return[4,new Promise(function(e){return setTimeout(e,400*t)})];case 7:return n.sent(),[2];case 8:return[2];}})})},e}();S.GamePresenterBase=ua;var hb=fa&&fa.__extends||function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function a(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(a.prototype=r.prototype,new a)}}(),ib=fa&&fa.__values||function(e){var t="function"==typeof Symbol&&Symbol.iterator,r=t&&e[t],a=0;if(r)return r.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&a>=e.length&&(e=void 0),{value:e&&e[a++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")},U=1,aa=20,ga=aa/1.555555555555,Ea=function(e){function t(t,r){var a,i,$=e.call(this,t,r)||this;$.foundationPiles_=[],$.tableauPiles_=[],(o=$.createPileView_(t.stock)).showFrame=!0,$.stockPile_=o,(o=$.createPileView_(t.waste)).showFrame=!0,o.zIndex=50,o.fanXUp=3,$.wastePile_=o;for(var n=0;n<$.game_.foundations.length;++n){(o=$.createPileView_(t.foundations[n])).showFrame=!0,o.zIndex=800,$.foundationPiles_.push(o)}for(n=0;n<$.game_.tableaux.length;++n){var o;(o=$.createPileView_(t.tableaux[n])).showFrame=!0,o.zIndex=800,$.tableauPiles_.push(o)}try{for(var s=ib(t.cards),h=s.next();!h.done;h=s.next()){var l=h.value;$.createCardView_(l)}}catch(u){a={error:u}}finally{try{h&&!h.done&&(i=s.return)&&i.call(s)}finally{if(a)throw a.error}}return $.layoutPiles_(),$}return hb(t,e),t.prototype.onResize_=function(){this.layoutPiles_()},t.prototype.layoutPiles_=function(){var e=this.game_.tableaux.length,t=1;window.matchMedia("screen and (max-aspect-ratio: 100/130)").matches&&(t=1.5);var r=function(t){return(t-.5*(e-1))*(ga+U)},a=this.game_.stock;($=this.getPileView_(a)).rect=new B(ga,aa,r(0),-35*t+U),this.relayoutPile_($,a);a=this.game_.waste;($=this.getPileView_(this.game_.waste)).rect=new B(ga,aa,r(1),-35*t+U),this.relayoutPile_($,a);for(var i=0;i<this.game_.foundations.length;++i){a=this.game_.foundations[i];($=this.getPileView_(a)).rect=new B(ga,aa,r(e-this.game_.foundations.length+i),-35*t+U),this.relayoutPile_($,a)}for(i=0;i<this.game_.tableaux.length;++i){var $;a=this.game_.tableaux[i];($=this.getPileView_(a)).rect=new B(ga,aa,r(i),-35*t+U+U+aa+U),$.fanYDown=3.5,$.fanYUp=3.5*t,this.relayoutPile_($,a)}},t}(ua);fa.GamePresenter=Ea;var Fa=function(){function e(){}return e.prototype.createGame=function(e,r){var $=new Ca(r),t=new Aa($),m=new wa(e);return new Ea(t,m)},e}();var V={};var jb=V&&V.__extends||function(){var e=function(r,t){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,r){e.__proto__=r}||function(e,r){for(var t in r)r.hasOwnProperty(t)&&(e[t]=r[t])})(r,t)};return function(r,t){function n(){this.constructor=r}e(r,t),r.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}}(),W=V&&V.__generator||function(e,r){var t,n,a,s,o={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return s={next:i(0),throw:i(1),return:i(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function i(s){return function(i){return function(s){if(t)throw new TypeError("Generator is already executing.");for(;o;)try{if(t=1,n&&(a=2&s[0]?n.return:s[0]?n.throw||((a=n.return)&&a.call(n),0):n.next)&&!(a=a.call(n,s[1])).done)return a;switch(n=0,a&&(s=[2&s[0],a.value]),s[0]){case 0:case 1:a=s;break;case 4:return o.label++,{value:s[1],done:!1};case 5:o.label++,n=s[1],s=[0];continue;case 7:s=o.ops.pop(),o.trys.pop();continue;default:if(!(a=(a=o.trys).length>0&&a[a.length-1])&&(6===s[0]||2===s[0])){o=0;continue}if(3===s[0]&&(!a||s[1]>a[0]&&s[1]<a[3])){o.label=s[1];break}if(6===s[0]&&o.label<a[1]){o.label=a[1],a=s;break}if(a&&o.label<a[2]){o.label=a[2],o.ops.push(s);break}a[2]&&o.ops.pop(),o.trys.pop();continue;}s=r.call(e,o)}catch(i){s=[6,i],n=0}finally{t=a=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,i])}}},G=V&&V.__values||function(e){var r="function"==typeof Symbol&&Symbol.iterator,t=r&&e[r],n=0;if(t)return t.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}};throw new TypeError(r?"Object is not iterable.":"Symbol.iterator is not defined.")},kb=7,Ga=function(e){function r(r){var t=e.call(this)||this;t.stock=new D(t),t.waste=new D(t),t.foundation=new D(t),t.pyramid=[],t.pyramidCoords_=new Map,t.restocks_=0,t.options=r,t.piles.push(t.stock),t.piles.push(t.waste),t.piles.push(t.foundation);for(var n=0;n<kb;++n){t.pyramid.push([]);for(var a=0;a<=n;++a){var s=new D(t);t.pyramid[n].push(s),t.pyramidCoords_.set(s,{x:a,y:n}),t.piles.push(s)}}return t.cards=na.createStandard52Deck(t.stock),t}return jb(r,e),r.prototype.restart_=function(e){var r,t,n,a,s,o,i,u,c,$,l,p,v,h,f,x,_,d,y;return W(this,function(F){switch(F.label){case 0:this.restocks_=0;try{for(r=G(this.stock),t=r.next();!t.done;t=r.next())(l=t.value).flip(!1)}catch(k){h={error:k}}finally{try{t&&!t.done&&(f=r.return)&&f.call(r)}finally{if(h)throw h.error}}for(n=this.piles.length;n-->0;)if(($=this.piles[n])!==this.stock)for(a=$.length;a-->0;)(l=$.at(a)).flip(!1),this.stock.push(l);return this.stock.sort(),this.stock.shuffle(e),[4,z.Settle];case 1:F.sent(),F.label=2;case 2:F.trys.push([2,13,14,15]),s=G(this.pyramid),o=s.next(),F.label=3;case 3:if(o.done)return[3,12];i=o.value,F.label=4;case 4:F.trys.push([4,9,10,11]),d=void 0,u=G(i),c=u.next(),F.label=5;case 5:return c.done?[3,8]:($=c.value,(l=this.stock.peek())?($.push(l),l.flip(!0),[4,z.Quick]):[3,7]);case 6:F.sent(),F.label=7;case 7:return c=u.next(),[3,5];case 8:return[3,11];case 9:return p=F.sent(),d={error:p},[3,11];case 10:try{c&&!c.done&&(y=u.return)&&y.call(u)}finally{if(d)throw d.error}return[7];case 11:return o=s.next(),[3,3];case 12:return[3,15];case 13:return v=F.sent(),x={error:v},[3,15];case 14:try{o&&!o.done&&(_=s.return)&&_.call(s)}finally{if(x)throw x.error}return[7];case 15:return[5,G(this.doAutoMoves_())];case 16:return F.sent(),[2];}})},r.prototype.cardPrimary_=function(e){return W(this,function(r){switch(r.label){case 0:return e.rank===j.King&&this.isFree_(e)?(this.foundation.push(e),[5,G(this.doAutoMoves_())]):[3,2];case 1:return r.sent(),[2];case 2:return this.stock.peek()!==e?[3,4]:(e.faceUp?this.waste.push(e):e.flip(!0),[5,G(this.doAutoMoves_())]);case 3:return r.sent(),[2];case 4:return[2];}})},r.prototype.cardSecondary_=function(e){return W(this,function(e){return[2]})},r.prototype.pilePrimary_=function(e){var r,t;return W(this,function(n){switch(n.label){case 0:if(!(e===this.stock&&0===this.stock.length&&this.waste.length>0&&this.restocks_<this.options.restocksAllowed))return[3,3];for(this.restocks_++,r=this.waste.length;r-->0;)(t=this.waste.at(r)).flip(!1);return[4,z.OneByOne];case 1:for(n.sent(),r=this.waste.length;r-->0;)t=this.waste.at(r),this.stock.push(t);return[5,G(this.doAutoMoves_())];case 2:return n.sent(),[2];case 3:return[2];}})},r.prototype.pileSecondary_=function(e){return W(this,function(e){return[2]})},r.prototype.canDrag_=function(e){return{canDrag:this.isFree_(e),extraCards:[]}},r.prototype.previewDrop_=function(e,r){return this.is13Move_(e,r)},r.prototype.dropCard_=function(e,r){return W(this,function(t){switch(t.label){case 0:return this.is13Move_(e,r)?(this.foundation.push(r.peek()),this.foundation.push(e),[5,G(this.doAutoMoves_())]):[3,2];case 1:t.sent(),t.label=2;case 2:return[2];}})},r.prototype.isFree_=function(e){if(!e.faceUp)return!1;if(this.stock.peek()===e)return!0;if(this.waste.peek()===e)return!0;if(e.pile){var r=this.pyramidCoords_.get(e.pile);if(r){var t=this.pyramid[r.y+1];if(!t)return!0;var n=t[r.x],a=t[r.x+1];return 0===n.length&&0===a.length}}return!1},r.prototype.is13Move_=function(e,r){if(e.pile===r)return!1;if(!this.isFree_(e))return!1;var t=r.peek();return!!t&&!!this.isFree_(t)&&this.getCardValue_(e)+this.getCardValue_(t)===13},r.prototype.getCardValue_=function(e){switch(e.rank){case j.Ace:return 1;case j.Two:return 2;case j.Three:return 3;case j.Four:return 4;case j.Five:return 5;case j.Six:return 6;case j.Seven:return 7;case j.Eight:return 8;case j.Nine:return 9;case j.Ten:return 10;case j.Jack:return 11;case j.Queen:return 12;case j.King:return 13;default:return 0;}},r.prototype.doAutoMoves_=function(){var e,r,t,n,a,s,o,i,u,c,$,l,p;return W(this,function(v){switch(v.label){case 0:return this.options.autoPlayKings?(u=this.stock.peek())&&this.isFree_(u)&&13===this.getCardValue_(u)?[4,z.OneByOne]:[3,2]:[3,17];case 1:return v.sent(),this.foundation.push(u),[3,0];case 2:return(u=this.waste.peek())&&this.isFree_(u)&&13===this.getCardValue_(u)?[4,z.OneByOne]:[3,4];case 3:return v.sent(),this.foundation.push(u),[3,0];case 4:v.trys.push([4,15,16,17]),c=void 0,e=G(this.pyramid),r=e.next(),v.label=5;case 5:if(r.done)return[3,14];t=r.value,v.label=6;case 6:v.trys.push([6,11,12,13]),l=void 0,n=G(t),a=n.next(),v.label=7;case 7:return a.done?[3,10]:(s=a.value,(u=s.peek())&&this.isFree_(u)&&13===this.getCardValue_(u)?[4,z.OneByOne]:[3,9]);case 8:return v.sent(),this.foundation.push(u),[3,0];case 9:return a=n.next(),[3,7];case 10:return[3,13];case 11:return o=v.sent(),l={error:o},[3,13];case 12:try{a&&!a.done&&(p=n.return)&&p.call(n)}finally{if(l)throw l.error}return[7];case 13:return r=e.next(),[3,5];case 14:return[3,17];case 15:return i=v.sent(),c={error:i},[3,17];case 16:try{r&&!r.done&&($=e.return)&&$.call(e)}finally{if(c)throw c.error}return[7];case 17:return this.options.autoRevealStockTop&&(u=this.stock.peek())&&!1===u.faceUp?[4,z.OneByOne]:[3,19];case 18:return v.sent(),u.flip(!0),[3,0];case 19:return[3,20];case 20:return[2];}})},r}(pa);V.Game=Ga;var va={};var lb=va&&va.__extends||function(){var t=function(o,e){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,o){t.__proto__=o}||function(t,o){for(var e in o)o.hasOwnProperty(e)&&(t[e]=o[e])})(o,e)};return function(o,e){function r(){this.constructor=o}t(o,e),o.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}}(),Ha=function(t){function o(o){var e=t.call(this,o)||this;return e.restocksAllowed=2,e.autoRevealStockTop=!0,e.autoPlayKings=!0,e.restocksAllowed=e.getFloat_("restocksAllowed",1/0),e.autoRevealStockTop=e.getBool_("autoRevealStockTop",!0),e.autoPlayKings=e.getBool_("autoPlayKings",!0),e}return lb(o,t),o}(Ba);va.GameOptions=Ha;var ha={};var mb=ha&&ha.__extends||function(){var e=function(r,$){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,r){e.__proto__=r}||function(e,r){for(var $ in r)r.hasOwnProperty($)&&(e[$]=r[$])})(r,$)};return function(r,$){function t(){this.constructor=r}e(r,$),r.prototype=null===$?Object.create($):(t.prototype=$.prototype,new t)}}(),nb=ha&&ha.__values||function(e){var r="function"==typeof Symbol&&Symbol.iterator,$=r&&e[r],t=0;if($)return $.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&t>=e.length&&(e=void 0),{value:e&&e[t++],done:!e}}};throw new TypeError(r?"Object is not iterable.":"Symbol.iterator is not defined.")},ba=20,P=ba/1.555555555555,ka=1.5,ob=-7,Ia=function(e){function r(r,$){var t,a,i=e.call(this,r,$)||this;i.pyramidPiles_=[];var n=function(e){return(e-.5*(r.pyramid.length-1))*(ba+ob)};(p=i.createPileView_(r.stock)).rect=new B(P,ba,(0-.5*(r.pyramid.length-1))*(P+ka),n(0)),p.showFrame=!0,i.stockPile_=p,(p=i.createPileView_(r.waste)).rect=new B(P,ba,(1-.5*(r.pyramid.length-1))*(P+ka),n(0)),p.showFrame=!0,p.zIndex=50,i.wastePile_=p,(p=i.createPileView_(r.foundation)).rect=new B(P,ba,(r.pyramid.length-1-.5*(r.pyramid.length-1))*(P+ka),n(0)),p.showFrame=!0,p.zIndex=800,i.foundationPile_=p;for(var o=0;o<r.pyramid.length;++o){i.pyramidPiles_.push([]);for(var f=r.pyramid[o],s=0;s<f.length;++s){var b=f[s],p=i.createPileView_(b);i.pyramidPiles_[o].push(p),p.rect=new B(P,ba,(s-.5*(f.length-1))*(P+ka),n(o)),p.zIndex=100*o}}try{for(var O=nb(r.cards),v=O.next();!v.done;v=O.next()){var c=v.value;i.createCardView_(c)}}catch(l){t={error:l}}finally{try{v&&!v.done&&(a=O.return)&&a.call(O)}finally{if(t)throw t.error}}return i}return mb(r,e),r.prototype.onResize_=function(){},r}(ua);ha.GamePresenter=Ia;var pb=function(){function e(){}return e.prototype.createGame=function(e,r){var $=new Ha(r),t=new Ga($),o=new wa(e);return new Ia(t,o)},e}();window.addEventListener("load",function(){var e,r=new Map;r.set("",new Fa),r.set("klondike",new Fa),r.set("pyramid",new pb);var a,n=null!==(e=document.getElementById("tableHolder"))&&void 0!==e?e:document.body,t=function(){var e;a&&(a.dispose(),a=void 0);var t,o,i=window.location.hash,d=i.indexOf("?");d>=0?(t=new URLSearchParams(i.substr(d+1)),o=i.substr(1,d-1)):i.indexOf("&")>=0||i.indexOf("?")>=0||i.indexOf("=")>=0?o=null!==(e=(t=new URLSearchParams(i.substr(1))).get("game"))&&void 0!==e?e:"klondike":(t=new URLSearchParams(""),o=i.substr(1));var s=r.get(o.toLowerCase());s||q.error("Unknown game "+o+"."),a=s.createGame(n,t)};window.addEventListener("hashchange",t),t()});return{"QCba":{}};});